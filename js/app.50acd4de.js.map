{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/scripts/space/globe/shaders.js","webpack:///./src/scripts/space/globe/camera.js","webpack:///./src/scripts/space/globe/scene.js","webpack:///./src/scripts/space/globe/renderer.js","webpack:///./src/scripts/map/heatmap.js","webpack:///./src/scripts/map/texture.js","webpack:///./src/scripts/map/map.js","webpack:///./src/scripts/map/decoder.js","webpack:///./src/scripts/space/utils/index.js","webpack:///./src/scripts/space/utils/events.js","webpack:///./src/scripts/space/space.js","webpack:///./src/scripts/desk/widget.js","webpack:///./src/scripts/desk/map/map.js","webpack:///./src/scripts/desk/table/table.js","webpack:///./src/scripts/desk/desk.js","webpack:///./src/scripts/service/data.js","webpack:///./src/scripts/index.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","particleVertexShader","join","particleFragmentShader","cameraPos0","cameraUp0","cameraZoom","iniQ","endQ","curQ","vec3","camera","PerspectiveCamera","innerWidth","innerHeight","position","copy","Vector3","clone","up","z","centerQ","Quaternion","quaternion","centerEuler","Euler","centerZoom","leftQ","setFromEuler","leftEuler","Math","atan","console","log","aspect","root","leftZoom","moveCameraFromCenterToLeft","ease","Sine","easeInOut","onUpdate","onSlerpUpdate","moveCameraFromLeftToCenter","slerp","this","target","x","y","applyQuaternion","World","mapCanvas","_this$scene","_ref","_classCallCheck","scene","Scene","light","HemisphereLight","set","add","waterMaterial","MeshPhongMaterial","color","emissive","transparent","shininess","fog","lights","PointLight","_toConsumableArray","spotTexture","ImageUtils","loadTexture","starTexture","sphere","SphereGeometry","baseLayer","Mesh","addEventListener","e","Object3D","worldOverlay","mapTexture","Texture","needsUpdate","mapMaterial","_defineProperty","map","atmospheraMaterial","intensity","fade","ShaderMaterial","uniforms","type","glowColor","Color","viewVector","vertexShader","fragmentShader","side","BackSide","blending","AdditiveBlending","glowMaterial","atmosphera","atmesh","mapLayer","geometry","BufferGeometry","vertices","ThreeMath","randFloatSpread","random","addAttribute","Float32BufferAttribute","starMaterial","particleTexture","texture","alphaTest","NormalBlending","depthTest","particleMaterial","particles","Points","_createClass","overlayMap","overlay","material","txt","sprite","remove","_this","Promise","resolve","TweenLite","to","turnY","rotation","turnX","easeOut","onTurnUpdate","onComplete","Linear","easeNone","PI","renderer","WebGLRenderer","antialias","setSize","simpleheat","canvas","_canvas","document","getElementById","_ctx","getContext","_width","width","_height","height","_max","_data","defaultRadius","defaultGradient","0.4","0.6","0.7","0.8","1","max","point","clear","radius","blur","undefined","circle","_circle","_createCanvas","ctx","r2","_r","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","beginPath","arc","closePath","fill","resize","gradient","grad","createLinearGradient","addColorStop","fillStyle","fillRect","_grad","getImageData","draw","minOpacity","clearRect","len","globalAlpha","min","drawImage","colored","_colorize","putImageData","pixels","createElement","constructor","projection","geoEquirectangular","translate","scale","geojson","context","select","append","style","attr","node","path","geoPath","strokeStyle","lineWidth","stroke","heatmapTexture","cities","heat","_objectSpread","coords","Number","lng","lat","count","body","appendChild","countries","emptyOverlay","emptyTexture","GeoDecoder","features","decoder_classCallCheck","store","reduce","acc","feature","id","decoder_createClass","find","country","pointInPolygon","coordinates","some","coord","code","properties","poly","xi","xj","yi","yj","inside","getEventCenter","event","a","face","b","latRads","acos","lngRads","atan2","raycaster","Raycaster","space","Space","space_classCallCheck","scaneBuilder","worldTexture","tokio","isLeft","isRunning","decoder","domElement","classList","watchResize","world","items","mouse","clientX","clientY","vector","unproject","ray","sub","normalize","intersectObjects","dispatchEvent","listenMouseEvents","render","getRotateGlobeTween","getWorldMap","drawWorld","latlon","countryID","search","countryOverlay","getOverlayMap","drawOverlay","focusGlobeOnLatLon","cleanOverlay","unfocusGlobe","heatmapOverlay","_this2","_convertToXYZ$call","sin","cos","_getEventRotationFrom2","space_slicedToArray","lonRads","turnGlobe","then","addPoint","_this3","removePoints","_loop","requestAnimationFrame","_render","state","updateProjectionMatrix","COLLAPSED_STATE","POSITION_TOP_RIGHT","POSITION_BOTTOM_LEFT","getWidgetWidth","widthFactor","getWidgetHeight","Widget","config","widget_classCallCheck","concat","widget_createClass","getTween","transform","getExpandedTranslateX","getExpandedTranslateY","getMinimizedTranslateX","getMinimizedTranslateY","Back","WIDGET_SCREEN_FACTOR","getProjection","geoEqualEarth","Map","_Widget","topology","map_classCallCheck","_possibleConstructorReturn","_getPrototypeOf","svg","points","_inherits","map_createClass","innerHTML","graticule","geoGraticule","datum","outline","selectAll","enter","insert","g","transformPoint","topojsonFeature","mapPoint","centroid","filter","transition","duration","Table","max_items","arguments","table_classCallCheck","table_possibleConstructorReturn","table_getPrototypeOf","rowHeight","maxItems","table_inherits","table_createClass","columns","html","header","getRowHeight","forEach","text","title","row","on","Desk","desk_classCallCheck","table","currentTimeline","desk_createClass","build","item","addRow","applySvgStats","mapExpand","expandTween","tableMinimize","minimizeTween","getRandomInt","ceil","floor","dataService","DataService","data_classCallCheck","daily_items","counter_items","_daily_subs","Set","_total_change","fn","delete","data_objectSpread","getTotal","values","_this4","all","fetch","_ref2","data_slicedToArray","r1","json","_ref3","_ref4","setInterval","city","addItem","country_props","App","scripts_classCallCheck","rotationGlobTimeline","emulate","objects","_this$rotationGlobTim","isMoved","desk","run","onDailyChange","watchPoint","addToTable","flag","toLowerCase","datetime","Date","toISOString","addToMap","timelineTable","TimelineLite","paused","setupDescriptionAnimation","restart","scripts_toConsumableArray","preventDefault","animateFromDescription","worldMain","animateToDescription","normalizeGlobe","worldAlternative","heatmapGlobe","_this$timelineDescrip","_this$timelineDescrip2","_this$timelineDescrip3","timelineDescription","getGlobeTween","_this$desk$getTweens","getTweens","isActive","pause","reverse"],"mappings":"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","file":"js/app.50acd4de.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([134,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import {\n  ShaderMaterial,\n  Color,\n  BackSide,\n  AdditiveBlending,\n  NormalBlending\n} from 'three';\n\nexport const atmosphere = {\n  uniforms: {},\n  vertexShader: [\n    'varying vec3 vNormal;',\n    'void main() {',\n    'vNormal = normalize( normalMatrix * normal );',\n    'gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\n    '}'\n  ].join('\\n'),\n  fragmentShader: [\n    'varying vec3 vNormal;',\n    'void main() {',\n    'float intensity = pow( 0.8 - dot( vNormal, vec3( 0, 0, 1.0 ) ), 12.0 );',\n    'gl_FragColor = vec4( 1.0, 0.3372, 0.0274, 1.0 ) * intensity;',\n    '}'\n  ].join('\\n')\n};\n\n\nconst particleVertexShader = \n[\n\"varying vec4  vColor;\",\n\"varying float vAngle;\",\n\"void main()\",\n\"{\",\n\t\"vColor = vec4( 1.0, 1.0, 1.0, 1.0 );\", //     set color associated to vertex; use later in fragment shader.\n\t\t\n\t\"vAngle = 1.2;\",\n\n\t\"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\",\n\t\"gl_PointSize = 18.0 * ( 350.0 / length( mvPosition.xyz ) );\",     // scale particles as objects in 3D space\n\t\"gl_Position = projectionMatrix * mvPosition;\",\n\"}\"\n].join(\"\\n\");\n\nconst particleFragmentShader =\n[\n\"uniform sampler2D texture;\",\n\"varying vec4 vColor;\", \t\n\"varying float vAngle;\",   \n\"void main()\", \n\"{\",\n\t\"gl_FragColor = vColor;\",\n\t\n\t\"float c = cos(vAngle);\",\n\t\"float s = sin(vAngle);\",\n\t\"vec2 rotatedUV = vec2(c * (gl_PointCoord.x - 0.5) + s * (gl_PointCoord.y - 0.5) + 0.5,\", \n\t                      \"c * (gl_PointCoord.y - 0.5) - s * (gl_PointCoord.x - 0.5) + 0.5);\",  // rotate UV coordinates to rotate texture\n    \t\"vec4 rotatedTexture = texture2D( texture,  rotatedUV );\",\n\t\"gl_FragColor = gl_FragColor * rotatedTexture;\",    // sets an otherwise white particle texture to desired color\n\"}\"\n].join(\"\\n\");\n\nexport function particleMaterial(particleTexture) {\n  return new ShaderMaterial( \n    {\n      uniforms: \n      {\n        texture:   { type: \"t\", value: particleTexture },\n      },\n      vertexShader:   particleVertexShader,\n      fragmentShader: particleFragmentShader,\n      transparent: true,  alphaTest: 0.5, // if having transparency issues, try including: alphaTest: 0.5, \n      blending: NormalBlending, depthTest: true\n    });\n}\n\nexport function glowMaterial(intensity, fade, color, camera) {\n  // Custom glow shader from https://github.com/stemkoski/stemkoski.github.com/tree/master/Three.js\n  return new ShaderMaterial({\n    uniforms: {\n      'c': {\n        type: 'f',\n        value: intensity\n      },\n      'p': {\n        type: 'f',\n        value: fade\n      },\n      glowColor: {\n        type: 'c',\n        value: new Color(color)\n      },\n      viewVector: {\n        type: 'v3',\n        value: camera.position\n      }\n    },\n    vertexShader: `\n        uniform vec3 viewVector;\n        uniform float c;\n        uniform float p;\n        varying float intensity;\n        void main() {\n          vec3 vNormal = normalize( normalMatrix * normal );\n          vec3 vNormel = normalize( normalMatrix * viewVector );\n          intensity = pow( c - dot(vNormal, vNormel), p );\n          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        }`,\n    fragmentShader: `\n        uniform vec3 glowColor;\n        varying float intensity;\n        void main() \n        {\n          vec3 glow = glowColor * intensity;\n          gl_FragColor = vec4( glow, 1.0 );\n        }`,\n    side: BackSide,\n    blending: AdditiveBlending,\n    transparent: true\n  });\n};\n","import {\n  PerspectiveCamera,\n  Quaternion,\n  Vector3,\n  Euler\n} from 'three';\nimport {\n  TweenLite,\n} from 'gsap/TweenLite';\nimport {\n  Sine,\n} from 'gsap';\nexport const camera = new PerspectiveCamera(30, window.innerWidth / window.innerHeight, 1, 6000);\nlet cameraPos0; // initial camera position\nlet cameraUp0; // initial camera up\nlet cameraZoom; // camera zoom\nlet iniQ; // initial quaternion\nlet endQ; // target quaternion\nlet curQ; // temp quaternion during slerp\nlet vec3; // generic vector object\nlet tweenValue; // tweenable value \ncamera.position.copy(new Vector3(0, 0, 1600));\ncameraPos0 = camera.position.clone();\ncameraUp0 = camera.up.clone();\ncameraZoom = camera.position.z;\nconst centerQ = new Quaternion().copy(camera.quaternion);\nconst centerEuler = new Euler(0.0, 0.0, 0.0);\nconst centerZoom = cameraZoom;\nconst leftQ = () => new Quaternion().setFromEuler(leftEuler());\nconst cameraYRotationNoRatioConstant = 0.16\nconst leftEuler = () => new Euler(0.0, Math.atan(cameraYRotationNoRatioConstant*(window.innerWidth / window.innerHeight)), 0.0);\nconsole.log(camera.aspect)\nconst leftZoom = 2300;\nconsole.log(leftEuler());\n\n// set a new target for the camera\nexport function moveCamera(euler, zoom) {\n  // reset everything\n  endQ = new Quaternion();\n  iniQ = new Quaternion().copy(camera.quaternion);\n  curQ = new Quaternion();\n  vec3 = new Vector3();\n  tweenValue = 0;\n  endQ.setFromEuler(euler);\n  return [{\n      value: 0,\n      cameraZoom: cameraZoom,\n    }, 1.3, {\n      value: 1,\n      ease: Sine.easeInOut,\n      cameraZoom: zoom,\n      onUpdate: onSlerpUpdate\n    }];\n}\n\nexport function moveCameraFromCenterToLeft() {\n  // reset everything\n  endQ = new Quaternion();\n  iniQ = new Quaternion().copy(centerQ);\n  curQ = new Quaternion();\n  vec3 = new Vector3();\n  tweenValue = 0;\n  endQ.setFromEuler(leftEuler());\n  return [{\n    value: 0,\n    cameraZoom: centerZoom,\n  }, 1.3, {\n    value: 1,\n    ease: Sine.easeInOut,\n    cameraZoom: leftZoom,\n    onUpdate: onSlerpUpdate\n  }];\n}\n\nexport function moveCameraFromLeftToCenter() {\n  // reset everything\n  endQ = new Quaternion();\n  iniQ = new Quaternion().copy(leftQ());\n  curQ = new Quaternion();\n  vec3 = new Vector3();\n  tweenValue = 0;\n  endQ.setFromEuler(centerEuler);\n  return [{\n    value: 0,\n    cameraZoom: leftZoom,\n  }, 1.3, {\n    value: 1,\n    ease: Sine.easeInOut,\n    cameraZoom: centerZoom,\n    onUpdate: onSlerpUpdate,\n  }];\n}\n\n// on every update of the tween\nfunction onSlerpUpdate() {\n  // interpolate quaternions with the current tween value\n  Quaternion.slerp(iniQ, endQ, curQ, this.target.value);\n\n  // apply new quaternion to camera position\n  vec3.x = cameraPos0.x;\n  vec3.y = cameraPos0.y;\n  vec3.z = this.target.cameraZoom;\n  vec3.applyQuaternion(curQ);\n  camera.position.copy(vec3);\n\n  // apply new quaternion to camera up\n  vec3 = cameraUp0.clone();\n  vec3.applyQuaternion(curQ);\n  camera.up.copy(vec3);\n}\n","import {\n  Scene,\n  HemisphereLight,\n  MeshPhongMaterial,\n  SphereGeometry,\n  Mesh,\n  Texture,\n  PointLight,\n  Object3D,\n  Points,\n  PointsMaterial,\n  BufferGeometry,\n  Float32BufferAttribute,\n  Math as ThreeMath,\n  ImageUtils,\n  Sprite,\n  SpriteMaterial,\n  MeshBasicMaterial,\n  UniformsUtils,\n  ShaderMaterial,\n  BackSide,\n  NormalBlending,\n  Vector3,\n  Vector2\n} from \"three\";\nimport { glowMaterial, particleMaterial } from \"~/scripts/space/globe/shaders\";\nimport { camera } from \"~/scripts/space/globe/camera\";\nimport { TweenLite } from \"gsap/TweenLite\";\nimport { Sine, Linear } from \"gsap\";\n\nlet root;\n\nexport class World {\n  constructor(mapCanvas) {\n    this.scene = new Scene();\n    this.light = new HemisphereLight(\"#ffffff\", \"#666666\", 1);\n    this.light.position.set(0, 500, 0);\n    this.scene.add(this.light);\n    this.waterMaterial = new MeshPhongMaterial({\n      color: \"#202020\",\n      emissive: 0x0,\n      transparent: true,\n      shininess: 30,\n      fog: true\n    });\n    this.lights = [];\n    this.lights[0] = new PointLight(0xffffff, 1.7, 0);\n    // this.lights[1] = new PointLight(0xffffff, 1, 0);\n    // lights[2] = new PointLight(0xffffff, 1, 0);\n\n    this.lights[0].position.set(5000, 0, 5000);\n    // this.lights[1].position.set(200, 1000, 200);\n    // this.lights[2].position.set(-600, -3000, -1500);\n\n    this.scene.add(...this.lights);\n\n    this.spotTexture = ImageUtils.loadTexture(\"/public/texture/mark.png\");\n    this.starTexture = ImageUtils.loadTexture(\"/public/texture/spikey.png\");\n\n    this.sphere = new SphereGeometry(200, 75, 75);\n    this.baseLayer = new Mesh(this.sphere, this.waterMaterial);\n    this.baseLayer.addEventListener(\"click\", e => console.log(\"click\", e));\n    this.root = new Object3D();\n    this.root.add(this.baseLayer);\n    this.worldOverlay = mapCanvas;\n    this.mapTexture = new Texture(mapCanvas);\n    this.mapTexture.needsUpdate = true;\n\n    this.mapMaterial = new MeshPhongMaterial({\n      color: \"#909090\",\n      map: this.mapTexture,\n      transparent: true,\n      emissive: 0x0,\n      transparent: true,\n      shininess: 30,\n      fog: true\n    });\n\n    this.atmospheraMaterial = glowMaterial(0.7, 7.0, \"#ff5607\", camera);\n    //this.atmospheraMaterial.opacity = 0.7;\n    this.atmosphera = new SphereGeometry(220, 75, 75);\n    this.atmesh = new Mesh(this.atmosphera, this.atmospheraMaterial);\n\n    this.mapLayer = new Mesh(this.sphere, this.mapMaterial);\n\n    this.root.add(this.mapLayer);\n    this.scene.add(this.atmesh);\n\n    var geometry = new BufferGeometry();\n    var vertices = [];\n    for (var i = 0; i < 10000; i++) {\n      vertices.push(ThreeMath.randFloatSpread(4000)); // x\n      vertices.push(ThreeMath.randFloatSpread(2000)); // y\n      vertices.push(Math.random() * -10); // z\n    }\n    geometry.addAttribute(\"position\", new Float32BufferAttribute(vertices, 3));\n    const starMaterial = particleMaterial(this.starTexture);\n    var particles = new Points(\n      geometry,\n      starMaterial\n    );\n    root = this.root;\n    this.scene.add(particles);\n    this.scene.add(this.root);\n  }\n\n  getOverlayMap() {\n    return this.overlayMap;\n  }\n\n  getWorldMap() {\n    return this.worldOverlay;\n  }\n\n  drawWorld() {\n    if (this.worldOverlay) {\n      this.mapTexture.needsUpdate = true;\n      return;\n    }\n  }\n\n  drawOverlay(map) {\n    if (this.overlayMap) {\n      this.overlay.material.map.needsUpdate = true;\n      return;\n    }\n    this.overlayMap = map;\n    const txt = new Texture(map);\n    txt.needsUpdate = true;\n    const material = new MeshPhongMaterial({map: txt, transparent: true});\n    if (!this.overlay) {\n      this.overlay = new Mesh(new SphereGeometry(200, 75, 75), material);\n      //this.overlay.rotation.y = Math.PI;\n      this.root.add(this.overlay);\n    } else {\n      this.overlay.material = material;\n    }\n  }\n\n  addPoint(x, y, z) {\n    this.sprite && this.root.remove(this.sprite);\n    const sphere = new SphereGeometry(2, 6, 6);\n    const material = new MeshPhongMaterial({\n      color: \"#000000\",\n      emissive: 0x0,\n      transparent: true,\n      shininess: 30,\n      fog: true\n    });\n    this.sprite = new Mesh(sphere, material);\n    //sprite.material.color.setRGB(1.0, 0, 0.5);\n    //sprite.material.blending = NormalBlending;\n    this.sprite.position.copy(new Vector3(x, y, z));\n    //sprite.center.copy(new Vector2(0.5, 0));\n\n    this.root.add(this.sprite);\n    console.log(\"added\", this.sprite, this.root);\n  }\n\n  removePoints() {\n    this.sprite && this.root.remove(this.sprite);\n    this.sprite = null;\n  }\n\n  cleanOverlay() {\n    if (this.overlayMap) {\n      this.overlay.material.map.needsUpdate = true;\n    }\n  }\n\n  turnGlobe(x, y) {\n    return new Promise(resolve => {\n      TweenLite.to(\n        {\n          turnY: this.root.rotation.y,\n          turnX: this.root.rotation.x\n        },\n        1,\n        {\n          turnY: y,\n          turnX: x,\n          ease: Sine.easeOut,\n          onUpdate: this.onTurnUpdate,\n          onComplete: resolve\n        }\n      );\n    });\n  }\n\n  getRotateGlobeTween() {\n    return [\n      {\n        turnX: this.root.rotation.x,\n        turnY: this.root.rotation.y,\n      },\n      5,\n      {\n\n        ease: Linear.easeNone,\n        turnX: 0,\n        turnY: this.root.rotation.y + Math.PI*2,\n        onUpdate: this.onTurnUpdate\n      }\n    ];\n  }\n\n  onTurnUpdate() {\n    if (this.target.turnY) {\n      root.rotation.y = this.target.turnY;\n    }\n    if (this.target.turnX) {\n      root.rotation.x = this.target.turnX;\n    }\n  }\n}\n","import {\n  WebGLRenderer\n} from 'three';\n\nexport const renderer = new WebGLRenderer({\n  antialias: true\n});\n\nrenderer.setSize(window.innerWidth, window.innerHeight);\n","// https://github.com/mourner/simpleheat\n\nexport function simpleheat(canvas) {\n    if (!(this instanceof simpleheat)) return new simpleheat(canvas);\n\n    this._canvas = canvas = typeof canvas === 'string' ? document.getElementById(canvas) : canvas;\n\n    this._ctx = canvas.getContext('2d');\n    this._width = canvas.width;\n    this._height = canvas.height;\n\n    this._max = 1;\n    this._data = [];\n}\n\nsimpleheat.prototype = {\n\n    defaultRadius: 25,\n\n    defaultGradient: {\n        0.4: 'blue',\n        0.6: 'cyan',\n        0.7: 'lime',\n        0.8: 'yellow',\n        1.0: 'red'\n    },\n\n    data: function (data) {\n        this._data = data;\n        return this;\n    },\n\n    max: function (max) {\n        this._max = max;\n        return this;\n    },\n\n    add: function (point) {\n        this._data.push(point);\n        return this;\n    },\n\n    clear: function () {\n        this._data = [];\n        return this;\n    },\n\n    radius: function (r, blur) {\n        blur = blur === undefined ? 15 : blur;\n\n        // create a grayscale blurred circle image that we'll use for drawing points\n        var circle = this._circle = this._createCanvas(),\n            ctx = circle.getContext('2d'),\n            r2 = this._r = r + blur;\n\n        circle.width = circle.height = r2 * 2;\n\n        ctx.shadowOffsetX = ctx.shadowOffsetY = r2 * 2;\n        ctx.shadowBlur = blur;\n        ctx.shadowColor = 'black';\n\n        ctx.beginPath();\n        ctx.arc(-r2, -r2, r, 0, Math.PI * 2, true);\n        ctx.closePath();\n        ctx.fill();\n\n        return this;\n    },\n\n    resize: function () {\n        this._width = this._canvas.width;\n        this._height = this._canvas.height;\n    },\n\n    gradient: function (grad) {\n        // create a 256x1 gradient that we'll use to turn a grayscale heatmap into a colored one\n        var canvas = this._createCanvas(),\n            ctx = canvas.getContext('2d'),\n            gradient = ctx.createLinearGradient(0, 0, 0, 256);\n\n        canvas.width = 1;\n        canvas.height = 256;\n\n        for (var i in grad) {\n            gradient.addColorStop(+i, grad[i]);\n        }\n\n        ctx.fillStyle = gradient;\n        ctx.fillRect(0, 0, 1, 256);\n\n        this._grad = ctx.getImageData(0, 0, 1, 256).data;\n\n        return this;\n    },\n\n    draw: function (minOpacity) {\n        if (!this._circle) this.radius(this.defaultRadius);\n        if (!this._grad) this.gradient(this.defaultGradient);\n\n        var ctx = this._ctx;\n\n        ctx.clearRect(0, 0, this._width, this._height);\n\n        // draw a grayscale heatmap by putting a blurred circle at each data point\n        for (var i = 0, len = this._data.length, p; i < len; i++) {\n            p = this._data[i];\n            ctx.globalAlpha = Math.min(Math.max(p[2] / this._max, minOpacity === undefined ? 0.05 : minOpacity), 1);\n            ctx.drawImage(this._circle, p[0] - this._r, p[1] - this._r);\n        }\n\n        // colorize the heatmap, using opacity value of each pixel to get the right color from our gradient\n        var colored = ctx.getImageData(0, 0, this._width, this._height);\n        this._colorize(colored.data, this._grad);\n        ctx.putImageData(colored, 0, 0);\n\n        return this;\n    },\n\n    _colorize: function (pixels, gradient) {\n        for (var i = 0, len = pixels.length, j; i < len; i += 4) {\n            j = pixels[i + 3] * 4; // get gradient color from opacity value\n\n            if (j) {\n                pixels[i] = gradient[j];\n                pixels[i + 1] = gradient[j + 1];\n                pixels[i + 2] = gradient[j + 2];\n            }\n        }\n    },\n\n    _createCanvas: function () {\n        if (typeof document !== 'undefined') {\n            return document.createElement('canvas');\n        } else {\n            // create a new canvas instance in node.js\n            // the canvas class needs to have a default constructor without any parameter\n            return new this._canvas.constructor();\n        }\n    }\n};\n","import {\n  Texture\n} from \"three\";\nimport {\n  geoEquirectangular,\n  geoPath,\n  select,\n  max\n} from \"d3\";\nimport {\n  feature as topojsonFeature\n} from 'topojson';\nimport {\n  simpleheat\n} from '~/scripts/map/heatmap';\n\nconst projection = geoEquirectangular()\n  .translate([2048, 1024])\n  .scale(650);  \n\nexport function emptyTexture(canvas) {\n  canvas = canvas ? select(canvas) : select(\"body\")\n    .append(\"canvas\")\n    .style(\"display\", \"none\")\n    .attr(\"width\", \"4096px\")\n    .attr(\"height\", \"2048px\");\n  \n  const context = canvas.node().getContext(\"2d\");\n  \n  context.clearRect(0, 0, canvas.node().width, canvas.node().height);\n  canvas.remove();\n  return canvas.node();\n}\n\nexport function mapTexture(geojson, color, canvas) {\n  canvas = canvas ? select(canvas) : select(\"body\")\n    .append(\"canvas\")\n    .style(\"display\", \"none\")\n    .attr(\"width\", \"4096px\")\n    .attr(\"height\", \"2048px\");\n\n  const context = canvas.node().getContext(\"2d\");\n\n  context.clearRect(0, 0, canvas.node().width, canvas.node().height);\n\n  var path = geoPath()\n    .projection(projection)\n    .context(context);\n\n  context.strokeStyle = \"#000\";\n  context.lineWidth = 0.5;\n  context.fillStyle = color || \"#CDB380\";\n  context.beginPath();\n  path(geojson);\n\n  if (color) {\n    context.fill();\n  }\n\n  context.stroke();\n\n  canvas.remove();\n\n  return canvas.node();\n}\n\nexport function heatmapTexture(cities, canvas) {\n  canvas = canvas ? select(canvas) : select(\"body\")\n    .append(\"canvas\")\n    .style(\"display\", \"none\")\n    .attr(\"width\", \"4096px\")\n    .attr(\"height\", \"2048px\");\n\n  const context = canvas.node().getContext(\"2d\");\n\n  context.clearRect(0, 0, canvas.node().width, canvas.node().height);\n\n  const heat = simpleheat(canvas.node());\n  const data = cities.map(c => ({... c, coords: projection([Number(c.lng), Number(c.lat)])}))\n  console.log('PRJ DATA', data);\n  heat.data(data.map(c => [c.coords[0], c.coords[1], c.count]));\n\n  heat.radius(10, 30);\n\n  heat.max(max(cities, c => +c.count));\n\n  heat.draw(0.1);\n  console.log('HEAAAAAATTTTT', canvas.node(), data.map(c => [c.coords[0], c.coords[1], c.count]), max(cities, c => +c.count), heat);\n  canvas.remove();\n  document.body.appendChild(canvas.style('display', 'block').node());\n  return canvas.node();\n}\n","import {\n  json\n} from 'd3';\nimport {\n  feature as topojsonFeature\n} from 'topojson';\nimport {\n  mapTexture,\n  emptyTexture,\n  heatmapTexture\n} from '~/scripts/map/texture';\nexport const loadMap = () => json('public/data/world.json').then(data => {\n  const countries = topojsonFeature(data, data.objects.countries);\n  const worldTexture = mapTexture(countries, '#ff5607');\n  return {worldTexture, countries, topology: data};\n});\n\nexport const worldOverlay = (countries, color, canvas) => {\n  return mapTexture(countries, color, canvas);\n};\n\nexport const countryOverlay = (country, color, canvas) => {\n  return mapTexture(country.geometry, color, canvas);\n};\n\nexport const emptyOverlay = (canvas) => emptyTexture(canvas);\n\nexport const heatmapOverlay = (cities, canvas) => heatmapTexture(cities, canvas);\n","export class GeoDecoder {\n  constructor(features) {\n    this.features = features;\n    this.store = features.reduce((acc, feature) => {\n      acc[feature.id] = feature;\n      return acc;\n    }, {});\n  }\n\n  find(id) {\n    return this.store[id];\n  }\n\n  search(lat, lng) {\n    const feature = this.features.find(country => {\n      switch (country.geometry.type) {\n        case 'Polygon':\n          return pointInPolygon(country.geometry.coordinates[0], [lng, lat])\n        case 'MultiPolygon':\n          return country.geometry.coordinates.some(coord => pointInPolygon(coord[0], [lng, lat]))\n      }\n    })\n\n    return feature ? {\n      code: feature.id,\n      name: feature.properties.name\n    } : null\n  }\n}\n\n// http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html\nfunction pointInPolygon(poly, point) {\n\n  let x = point[0];\n  let y = point[1];\n\n  let inside = false, xi, xj, yi, yj, xk;\n\n  for (let i = 0, j = poly.length - 1; i < poly.length; j = i++) {\n    xi = poly[i][0];\n    yi = poly[i][1];\n    xj = poly[j][0];\n    yj = poly[j][1];\n\n    xk = ((yi > y) !== (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n    if (xk) {\n       inside = !inside;\n    }\n  }\n\n  return inside;\n};","export function getPoint(event) {\n\n  // Get the vertices\n  let a = this.geometry.vertices[event.face.a];\n  let b = this.geometry.vertices[event.face.b];\n  let c = this.geometry.vertices[event.face.c];\n\n  // Averge them together\n  let point = {\n    x: (a.x + b.x + c.x) / 3,\n    y: (a.y + b.y + c.y) / 3,\n    z: (a.z + b.z + c.z) / 3\n  };\n\n  return point;\n}\n\nexport function getEventCenter(event, radius) {\n  radius = radius || 200;\n\n  var point = getPoint.call(this, event);\n\n  var latRads = Math.acos(point.y / radius);\n  var lngRads = Math.atan2(point.z, point.x);\n  var lat = (Math.PI / 2 - latRads) * (180 / Math.PI);\n  var lng = (Math.PI - lngRads) * (180 / Math.PI);\n\n  return [lat, lng - 180];\n}\n\nexport function getEventRotation(event, radius) {\n  var [lat, lng] = getEventCenter.call(this, event, radius)\n  // start point for lng is -90.0\n  return [lat * Math.PI / 180, (lng + 90) * Math.PI / 180];\n}\n\nexport function getEventRotationFromLatLng(lat, lng, radius) {\n  // start point for lng is -90.0\n  return [lat * Math.PI / 180, (lng + 90) * Math.PI / 180];\n}\n\nexport function convertToXYZ(point, radius) {\n  radius = radius || 200;\n\n  var latRads = (90 - point[0]) * Math.PI / 180;\n  var lngRads = (180 - point[1]) * Math.PI / 180;\n\n  var x = radius * Math.sin(latRads) * Math.cos(lngRads);\n  var y = radius * Math.cos(latRads);\n  var z = radius * Math.sin(latRads) * Math.sin(lngRads);\n\n  return {\n    x: -x,\n    y: y,\n    z: -z\n  };\n}\n","import {\n  Raycaster,\n  Vector3\n} from 'three';\n\nlet raycaster = new Raycaster();\n\nexport function listenMouseEvents(camera, items, type) {\n  let listener = function (event) {\n\n    let mouse = {\n      x: ((event.clientX - 1) / window.innerWidth) * 2 - 1,\n      y: -((event.clientY - 1) / window.innerHeight) * 2 + 1\n    };\n\n    let vector = new Vector3();\n    vector.set(mouse.x, mouse.y, 0.5);\n    vector.unproject(camera);\n\n    raycaster.ray.set(camera.position, vector.sub(camera.position).normalize());\n\n    let target = raycaster.intersectObjects(items);\n\n    if (target.length) {\n      target[0].type = type;\n      target[0].object.dispatchEvent(target[0]);\n    }\n\n  };\n  document.addEventListener(type, listener, false);\n}\n","import {\n  World,\n  camera,\n  renderer,\n  moveCamera,\n  moveCameraFromCenterToLeft,\n  moveCameraFromLeftToCenter\n} from '~/scripts/space/globe';\nimport {\n  loadMap,\n  worldOverlay,\n  countryOverlay,\n  emptyOverlay,\n  heatmapOverlay\n} from '~/scripts/map/map';\nimport {\n  GeoDecoder\n} from '~/scripts/map/decoder';\nimport {\n  Euler\n} from 'three';\nimport {\n  getEventCenter,\n  getEventRotation,\n  getEventRotationFromLatLng,\n  getPoint,\n  convertToXYZ\n}\nfrom '~/scripts/space/utils';\nimport {\n  listenMouseEvents\n}\nfrom '~/scripts/space/utils/events.js';\nimport { throws } from 'assert';\n\nexport const GLOBE_STATE_LEFT = 'LEFT';\nexport const CLOBE_STATE_CENTER = 'CENTER';\nexport const CLOBE_STATE_RIGHT = 'RIGHT';\n\nconst _render = (renderer, scene, camera) => {\n  const _loop = () => {\n    requestAnimationFrame(_loop);\n    renderer.render(scene, camera);\n  }\n  _loop();\n}\n\nclass Space {\n  constructor() {\n    this.renderer = renderer;\n    this.camera = camera;\n    this.scaneBuilder = null;\n    this.worldTexture = null;\n    this.tokio = [35.6890248, 139.7284301];\n    this.isLeft = false;\n    this.isRunning = false;\n    this.countries = null;\n    this.decoder = null;\n  }\n  run(data) {\n    this.renderer.domElement.classList.add('canvas-3d');\n    document.body.appendChild(this.renderer.domElement);\n    this.watchResize();\n    const {countries} = data;\n    this.worldTexture = worldOverlay(countries, '#ff5607');\n    this.countries = countries;\n    this.world = new World(this.worldTexture);\n    this.decoder = new GeoDecoder(countries.features);\n    listenMouseEvents(this.camera, [this.world.baseLayer], 'click');\n    // debug clicks\n    this.world.baseLayer.addEventListener('click', e => {\n      let latlon = getEventCenter.call(this.world.baseLayer, e);\n    });\n    this.render();\n  }\n\n  getRotateGlobeTween() {\n    return this.world.getRotateGlobeTween()\n  }\n\n  worldMain() {\n    this.worldTexture = worldOverlay(this.countries, '#ff5607', this.world.getWorldMap());\n    this.world.drawWorld();\n  }\n\n  worldAlternative() {\n    this.worldTexture = worldOverlay(this.countries, '#ffffff', this.world.getWorldMap());\n    this.world.drawWorld();\n  }\n\n  watchPoint(latlon) {\n    const countryID = this.decoder.search(latlon[0], latlon[1]);\n    if (!countryID) return;\n    const country = this.decoder.find(countryID.code);\n    const overlay = countryOverlay(country, '#ffffff', this.world.getOverlayMap());\n    this.world.drawOverlay(overlay);\n    this.focusGlobeOnLatLon(latlon);\n  }\n\n  normalizeGlobe() {\n    const overlay = emptyOverlay(this.world.getOverlayMap());\n    this.world.cleanOverlay(overlay);\n    this.unfocusGlobe();\n  }\n\n  heatmapGlobe(cities) {\n    const overlay = heatmapOverlay(cities, this.world.getOverlayMap());\n    this.world.drawOverlay(overlay);\n  }\n \n  focusGlobeOnLatLon(latlon) {\n    if (!this.isRunning) {\n      this.isRunning = true;\n      var {\n        x,\n        y,\n        z\n      } = convertToXYZ.call(this.world.baseLayer, latlon); //getPoint.call(this.world.baseLayer, e);\n      console.log(x,\n        y,\n        z);\n      let [latRads, lonRads] = getEventRotationFromLatLng.call(this.world.baseLayer, latlon[0], latlon[1]);\n      this.world.turnGlobe(latRads, -lonRads).then(() => {\n        this.isRunning = false;\n      });\n      this.world.addPoint(x, y, z);\n    }\n  }\n\n  unfocusGlobe() {\n    if (!this.isRunning) {\n      this.isRunning = true;\n      this.world.turnGlobe(0, 0).then(() => {\n        this.isRunning = false;\n      });\n      this.world.removePoints();\n    }\n  }\n\n  render() {\n    _render(this.renderer, this.world.scene, this.camera);\n  }\n  getGlobeTween(state) {\n    const f = state === GLOBE_STATE_LEFT ? moveCameraFromCenterToLeft : moveCameraFromLeftToCenter;\n    return f();\n  }\n  watchResize() {\n    (function (camera, renderer) {\n      function onWindowResize() {\n        camera.aspect = window.innerWidth / window.innerHeight;\n        camera.updateProjectionMatrix();\n        renderer.setSize(window.innerWidth, window.innerHeight);\n      }\n      window.addEventListener('resize', onWindowResize, false);\n    })(this.camera, this.renderer)\n  }\n}\n\nexport const space = new Space();\n","import {\n    TweenLite,\n} from 'gsap/TweenLite';\nimport {\n    Sine,\n    Back\n} from 'gsap';\n\nconst WIDGET_HEIGHT_RATIO = 0.52;\nconst EXPANDED_SCALE = 1.4;\nconst MINIMIZED_SCALE = 0.8;\nexport const COLLAPSED_STATE = 'collapsed';\nexport const MINIMIZED_STATE = 'minimized';\nexport const EXPANDED_STATE = 'expanded';\n\n\nexport const POSITION_TOP_RIGHT = 'top-right';\nexport const POSITION_TOP_LEFT = 'top-left';\nexport const POSITION_BOTTOM_RIGHT = 'bottom-right';\nexport const POSITION_BOTTOM_LEFT = 'bottom-left';\n\nconst getWidgetWidth = (widthFactor) => window.innerWidth * widthFactor;\nconst getWidgetHeight = (widthFactor) => getWidgetWidth(widthFactor) * WIDGET_HEIGHT_RATIO;\n\nexport class Widget {\n    constructor(node, config) {\n        const {position, widthFactor} = config;\n        this.state = COLLAPSED_STATE;\n        this.position = position;\n        this.widthFactor = widthFactor;\n        this.node = node;\n        this.node.attr('class', `widget widget-${position}`);\n    }\n\n    getExpandedTranslateX() {\n        switch (this.position) {\n            case POSITION_BOTTOM_LEFT:\n            case POSITION_TOP_LEFT:\n                return `${window.innerWidth*0.66 - getWidgetWidth(this.widthFactor)*0.5}px`;\n            case POSITION_BOTTOM_RIGHT:\n            case POSITION_TOP_RIGHT:\n                return `-${window.innerWidth*0.33 - getWidgetWidth(this.widthFactor)*0.5}px`;\n        }\n    }\n\n    getExpandedTranslateY() {\n        switch (this.position) {\n            case POSITION_BOTTOM_LEFT:\n            case POSITION_BOTTOM_RIGHT:\n                return `-${window.innerHeight*0.7 - getWidgetHeight(this.widthFactor)*0.5}px`;\n            case POSITION_TOP_LEFT:\n            case POSITION_TOP_RIGHT:\n                return `${window.innerHeight*0.3 - getWidgetHeight(this.widthFactor)*0.5}px`;\n        }\n    }\n\n    getMinimizedTranslateX() {\n        switch (this.position) {\n            case POSITION_BOTTOM_LEFT:\n            case POSITION_TOP_LEFT:\n                return `${window.innerWidth*0.66 - getWidgetWidth(this.widthFactor)*0.5}px`;\n            case POSITION_BOTTOM_RIGHT:\n            case POSITION_TOP_RIGHT:\n                return `-${window.innerWidth*0.33 - getWidgetWidth(this.widthFactor)*0.5}px`;\n        }\n    }\n\n    getMinimizedTranslateY() {\n        switch (this.position) {\n            case POSITION_BOTTOM_LEFT:\n            case POSITION_BOTTOM_RIGHT:\n                return `0px`; // `${window.innerHeight*0.7 - getWidgetHeight(this.widthFactor)*0.5}px`;\n            case POSITION_TOP_LEFT:\n            case POSITION_TOP_RIGHT:\n                return `0px`; // `${window.innerHeight*0.3 - getWidgetHeight(this.widthFactor)*0.5}px`;\n        }\n    }\n\n    collapseTween() {\n        return this.getTween(COLLAPSED_STATE);\n    }\n\n    expandTween() {\n        return this.getTween(EXPANDED_STATE);\n    }\n\n    minimizeTween() {\n        return this.getTween(MINIMIZED_STATE);\n    }\n\n    getTween(state) {\n        switch (state) {\n            case EXPANDED_STATE:\n                return [this.node.node(), 1.3, \n                {\n                    transform: `translate(${this.getExpandedTranslateX()},${this.getExpandedTranslateY()}) scale(${EXPANDED_SCALE})`,\n                    ease: Sine.easeInOut,\n                }];\n            case MINIMIZED_STATE:\n                return [this.node.node(), 1.3, \n                {\n                    transform: `translate(${this.getMinimizedTranslateX()},${this.getMinimizedTranslateY()}) scale(${MINIMIZED_SCALE})`,\n                    ease: Back.easeInOut,\n                }];\n            case COLLAPSED_STATE:\n                return [this.node.node(), 1.3, {transform: `translate(0px,0px)`, ease: Sine.easeInOut}];\n        }\n    }\n\n    getWidgetWidth() {\n        return getWidgetWidth(this.widthFactor);\n    }\n\n    getWidgetHeight() {\n        return getWidgetHeight(this.widthFactor);\n    }\n}","import {\n    geoPath,\n    select,\n    geoEqualEarth,\n    geoGraticule,\n    scaleSqrt\n  } from \"d3\";\n  import {\n    feature as topojsonFeature\n  } from 'topojson';\n  import { Widget, POSITION_TOP_RIGHT } from '~/scripts/desk/widget.js';\n\nconst WIDGET_SCREEN_FACTOR = 0.375;\n\nconst getProjection = () => geoEqualEarth()\n    .translate([480, 250])\n    .scale(175);\n\nfunction getRadius(n) {\n    return scaleSqrt().domain([0, 3000]).range([0, 15])(n)\n  }\n\nfunction mapPoint(topology, point) {\n  const p = transformPoint(topology, point);\n  return topojsonFeature(topology, {\n    type: \"Point\",\n    coordinates: p,\n  })\n}   \n\nfunction transformPoint(topology, position) {\n  position = position.slice();\n  position[0] = (position[0] - topology.transform.translate[0])\n  /(topology.transform.scale[0]),\n  position[1] = (position[1] - topology.transform.translate[1])\n  /(topology.transform.scale[1]) \n  return position;\n};\n\nexport class Map extends Widget {\n    constructor(topology, geojson) {\n        super(select(\"body\").append(\"svg\"), {position: POSITION_TOP_RIGHT, widthFactor: WIDGET_SCREEN_FACTOR});\n        this.topology = topology;\n        this.geojson = geojson;\n        this.svg = this.node;\n        this.svg.attr('viewBox', '0 0 960 500');\n        this.points = [];\n    }\n\n    clear() {\n        if (this.svg) {\n            this.svg.node().innerHTML = \"\";\n        }\n    }\n\n    build() {\n        this.clear()\n        const svg = this.svg;\n        svg.attr(\"width\", this.getWidgetWidth())\n            .attr(\"height\", this.getWidgetHeight());\n        const path = geoPath().projection(getProjection(this.getWidgetWidth(), this.getWidgetHeight()));\n\n        const graticule = geoGraticule();\n        \n        svg.append(\"path\")\n            .datum(graticule)\n            .attr(\"class\", \"graticule\")\n            .attr(\"d\", path);\n        \n        svg.append(\"path\")\n            .datum(graticule.outline)\n            .attr(\"class\", \"graticule outline\")\n            .attr(\"d\", path);\n        svg.selectAll(\".country\")\n            .data(this.geojson.features)\n            .enter()\n            .insert(\"path\", \".graticule\")\n            .attr(\"class\", \"country\")\n            .attr(\"d\", path);\n    }\n\n    applySvgStats(points) {\n        const path = geoPath().projection(getProjection(this.getWidgetWidth(), this.getWidgetHeight()));;\n        const svg = this.svg;\n        const g = svg.select(\"g\");\n        console.log('this.points', this.points);\n        this.points = this.points.concat(points.map(p => mapPoint(this.topology, p)))\n        console.log(this.points);\n        (g.node() ? g : svg.append(\"g\"))\n            .attr(\"class\", \"stats\")\n            .attr(\"fill\", \"green\")\n            .attr(\"fill-opacity\", 0.5)\n            .attr(\"stroke\", \"#fff\")\n            .attr(\"stroke-width\", 0.5)\n        .selectAll(\"circle\")\n            .data(this.points)\n            .enter()\n            .append(\"circle\")\n            .attr(\"cx\", function (d) { return path.centroid(d)[0]; })\n            .attr(\"cy\", function (d) { return path.centroid(d)[1]; })\n            .attr(\"r\", d => 50)\n            .filter(d => {\n                console.log('datum', d);\n                return true\n            })\n            .transition()\n            .duration(500)\n            .attr(\"r\", 2.5)\n    }\n};\n  \n","import { Widget, POSITION_BOTTOM_LEFT } from \"~/scripts/desk/widget\";\nimport { select } from 'd3';\n\nconst WIDGET_SCREEN_FACTOR = 0.34;\n\nexport class Table extends Widget {\n    constructor(max_items = 5) {\n        super(select(\"body\").append(\"table\"), {position: POSITION_BOTTOM_LEFT, widthFactor: WIDGET_SCREEN_FACTOR});\n        this.rowHeight = 100 / (max_items + 2)\n        this.maxItems = max_items;\n        this.body = null;\n    }\n\n    getRowHeight() {\n        return this.getWidgetHeight() / (this.maxItems + 2)\n    }\n    \n    build(columns) {\n        this.node.html('');\n        const header = this.node\n            .attr('width', this.getWidgetWidth()+'px')\n            .attr('style', 'margin: 15px;')\n            .append('thead')\n            .append('tr')\n            .attr('height', this.getRowHeight()+'px');\n        this.columns = columns;\n        this.columns.forEach(c => {\n            header.append('th').text(c.title)\n        });\n        this.body = this.node.append('tbody');\n        for (let i = 0; i < this.maxItems; i++) {\n            const row = this.body\n                .append('tr')\n                .attr('height', this.getRowHeight()+'px');\n            this.columns.forEach(c => {\n                row.append('td')\n            });\n        }\n    }\n\n    addRow(data) {\n        const {body, columns} = this;\n        const rowHeight = this.getRowHeight();\n        body.select('tr:last-of-type')\n            .transition()\n            .style('transform', `translateY(${rowHeight}px)`)\n            .duration(500)\n            .on('end', function() {\n                this.remove();\n                const row = body.insert('tr', ':first-child').attr('class', 'with-data').attr('height', rowHeight+'px').style('transform', 'translate(50%)');\n                columns.forEach(c => {\n                    row.append('td').html(data[c.key]);\n                });\n                row.transition().duration(500).style('transform', 'translate(0)');\n            });\n    }\n}\n","import {\n    Map\n  } from '~/scripts/desk/map/map.js';\n  import {\n    Table\n  } from '~/scripts/desk/table/table.js';\n  import {\n    TimelineLite\n  } from 'gsap';\n\nexport class Desk {\n    constructor(topology, countries) {\n        this.map = new Map(topology, countries);\n        this.table = new Table();\n        this.currentTimeline = null;\n    }\n    build(columns) {\n        this.table.build(columns);\n        this.map.build();\n        // this.table.addRow();\n        // map.applySvgStats([[-0.127758, 51.507351], [-74.1140279, 40.6891766], [30.5238, 50.4547]]);\n        \n    }\n\n    addToTable(item) {\n        console.log(item);\n        this.table.addRow(item);\n    }\n\n    addToMap(item) {\n        console.log('addToMap', item);\n        this.map.applySvgStats([[Number(item.lng), Number(item.lat)]]);\n    }\n\n    getTweens() {\n        return {\n            mapExpand: this.map.expandTween(),\n            tableMinimize: this.table.minimizeTween(),\n        }\n    }\n}\n","const TOTAL = 128769;\n\nfunction getRandomInt(min, max) {\n    min = Math.ceil(min);\n    max = Math.floor(max);\n    return Math.floor(Math.random() * (max - min)) + min;\n}\n\nclass DataService {\n    constructor() {\n        this.daily_items = [];\n        this.counter_items = {};\n        this._daily_subs = new Set();\n        this._total_change = new Set();\n    }\n\n    onDailyChange(fn) {\n        this._daily_subs.add(fn);\n        return () => this._daily_subs.delete(fn);\n    }\n\n    onTotalChange(fn) {\n        this._total_change.add(fn);\n        return () => this._total_change.delete(fn);\n    }\n\n    addItem(item) {\n        this.daily_items.push(item);\n        const key = `${item.country}:${item.name}`;\n        const c = this.counter_items[key];\n        this.counter_items[key] = c ? {...c, count: c.count + item.count} : {...item, count: item.count};\n        this._daily_subs.forEach(fn => fn({event: 'add', data: item}));\n        this._total_change.forEach(fn => fn(this.getTotal()))\n    }\n\n    getTotal() {\n        return Object.values(this.counter_items);\n    }\n\n    emulate() {\n        Promise.all([fetch('public/data/cities.json'), fetch('public/data/countries.json')])\n            .then(([r1, r2]) => Promise.all([r1.json(), r2.json()]))\n            .then(([cities, countries]) => {\n                setInterval(() => {\n                    const city = cities[getRandomInt(0, TOTAL)];\n                    const country = countries[city.country];\n                    this.addItem({...city, country_props: country, count: getRandomInt(1, 3)});\n                }, 3000)\n            })\n    }\n};\n\nexport const dataService = new DataService();\n","import '~/styles/index.scss';\nimport {\n  space,\n  GLOBE_STATE_LEFT,\n  GLOBE_STATE_CENTER\n}\nfrom '~/scripts/space/space.js';\nimport {\n  Desk\n} from '~/scripts/desk/desk.js';\nimport {\n  loadMap\n} from '~/scripts/map/map.js';\nimport {\n  dataService\n} from '~/scripts/service/data.js';\nimport {\n  TimelineLite\n} from 'gsap';\n\nconst STATE_FOCUS_ON_MAP = 'MAP';\nconst STATE_FOCUS_ON_GLOBE = 'GLOBE';\nconst STATE_FOCUS_ON_TABLE = 'TABLE';\n\nclass App {\n  constructor(space) {\n    this.currentTimeline = null;\n    this.rotationGlobTimeline = null;\n    this.space = space;\n    this.dataService = dataService;\n  }\n\n  run() {\n    dataService.emulate();\n    loadMap().then(data => {\n      let isMoved = false;\n      const columns = [{\"key\": \"flag\", \"title\": \"\"}, {\"key\": \"country\", \"title\": \"Country\"}, {\"key\": \"city\", \"title\": \"City\"}, , {\"key\": \"datetime\", \"title\": \"Datetime\"}];\n      this.desk = new Desk(data.topology, data.countries);\n      this.desk.build(columns);\n      this.space.run(data);\n      \n      this.dataService.onDailyChange(value => {\n        if (!isMoved) {\n          space.watchPoint([Number(value.data.lat), Number(value.data.lng)]);\n        }\n        console.log('TOTAL', this.dataService.getTotal());\n        this.desk.addToTable({\"flag\": `<img src='https://www.countryflags.io/${value.data.country.toLowerCase()}/flat/32.png'/ alt='${value.data.country}-flag'>`, \"country\": value.data.country_props.name, \"city\": value.data.name, \"datetime\": (new Date).toISOString()})\n        this.desk.addToMap(value.data);\n      });\n\n      this.timelineTable = new TimelineLite({ paused: true });\n      this.setupDescriptionAnimation();\n      this.rotationGlobTimeline = new TimelineLite({ \n        paused: true, \n        onComplete: function() {\n          this.restart();\n        }\n      });\n      this.rotationGlobTimeline.to(...this.space.getRotateGlobeTween())\n\n\n      document.body.addEventListener('contextmenu', (e) => {\n        e.preventDefault();\n        if (isMoved) {\n          this.animateFromDescription();\n          space.worldMain();\n          isMoved = false;\n        } else {\n          this.animateToDescription();\n          isMoved = true;\n          space.normalizeGlobe();\n          space.worldAlternative();\n          space.heatmapGlobe(this.dataService.getTotal());\n        }\n      });\n    })\n  }\n\n  setupDescriptionAnimation() {\n    this.timelineDescription = new TimelineLite({ paused: true });\n    this.timelineDescription.to(...this.space.getGlobeTween(GLOBE_STATE_LEFT));\n    const {mapExpand, tableMinimize} = this.desk.getTweens();\n    this.timelineDescription.to(...mapExpand, '-=1.3');\n    this.timelineDescription.to(...tableMinimize, '-=1.3');\n  }\n\n  animateToDescription() {\n    if (this.currentTimeline && this.currentTimeline.isActive()) {\n        this.currentTimeline.pause();\n        this.rotationGlobTimeline.pause();\n    };\n    this.currentTimeline = this.timelineDescription;\n    this.currentTimeline.restart();\n    this.rotationGlobTimeline.restart();\n  }\n\n  animateFromDescription() {\n    if (this.currentTimeline && this.currentTimeline.isActive()) {\n        this.currentTimeline.pause();\n    };\n    this.currentTimeline = this.timelineDescription;\n    this.currentTimeline.reverse();\n    this.rotationGlobTimeline.pause();\n  }\n} \n\nconst app = new App(space);\n\napp.run();\n"],"sourceRoot":""}